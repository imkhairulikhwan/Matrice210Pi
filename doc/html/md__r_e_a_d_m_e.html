<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Matrice210Pi: Matrice210Pi</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Matrice210Pi
   </div>
   <div id="projectbrief">Embedded code deployed on Pi Zero W</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md__r_e_a_d_m_e.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Matrice210Pi </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This code uses <a href="https://github.com/dji-sdk/Onboard-SDK/">DJI Onboard SDK</a> to communicate with DJI flight controllers.</p>
<h2>Prerequisites</h2>
<p>Code compiled with <a href="https://cmake.org/">CMake</a> 3.7.2 on a <a href="https://www.raspberrypi.org/products/raspberry-pi-zero-w/">Raspberry Pi Zero W</a> with <a href="https://www.raspberrypi.org/downloads/raspbian/">Raspbian Stretch Lite</a> (June 2018 - Kernel version:4.14).</p>
<h3>UART</h3>
<p><a href="https://github.com/dji-sdk/Onboard-SDK/">DJI Onboard SDK</a> uses serial UART driver to communicate with DJI flight controllers. The UART transmit and receive pins are on GPIO 14 and GPIO 15 respectively, which are pins 8 and 10 on the GPIO header.</p>
<p>In a default install of Raspbian on a Raspberry, the primary UART <code>/dev/serial0</code> is assigned to the Linux console. To stop this behaviour, the serial console setting needs to be removed from command line. This can be done using the https://www.raspberrypi.org/documentation/configuration/raspi-config.md "raspi-config" :</p>
<div class="fragment"><div class="line">sudo raspi-config</div></div><!-- fragment --><p> Select option 5, <b>Interfacing options</b>, then option <b>Serial</b>, then <b>Disable serial login shell</b> (disable linux's use of console uart) and <b>Enable serial interface</b>. Exit raspi-config and reboot</p>
<h3>UART by USB</h3>
<p>The <a href="https://www.st.com/en/evaluation-tools/32f429idiscovery.html">32F429IDISCOVERY</a> card used by the embedded sensor transmits values by UART. It is connected to a USB-TTL adaptator and uses USB User port <code>/dev/ttyUSB0</code> on the Pi Zero W.</p>
<h2>Install</h2>
<p>Clone the <a href="https://github.com/dji-sdk/Onboard-SDK/">DJI Onboard SDK</a> repository and configure <code>ONBOARDSDK_SOURCE</code> in <a href="CMakeLists.txt">CMakeList.txt</a> depending on your repository location.</p>
<p>In the <code>Matrice210Pi</code> root directory, run the following commands to build the app: </p><div class="fragment"><div class="line">mkdir build &amp;&amp; cd build</div><div class="line">cmake ..</div><div class="line">make</div><div class="line">cd bin</div></div><!-- fragment --><p>You have to copy the <code>UserConfig.txt</code> file provided by DJI in the <code>bin</code> directory and fill it in with your configuration informations. You must register as a developer with DJI and create an OSDK application ID and Key pair, see <a href="https://developer.dji.com/onboard-sdk/documentation/development-workflow/environment-setup.html#onboard-sdk-application-registration">here</a>.</p>
<p>Be sure Onboard SDK is enabled on the aircraft and the baudrate used in <code>UserConfig.txt</code> file is the same as defined with DJI Assistant 2, more informations <a href="https://developer.dji.com/onboard-sdk/documentation/development-workflow/environment-setup.html">here</a>.</p>
<p>More informations can be found in the <a href="https://developer.dji.com/onboard-sdk/documentation/quick-start/quick-start.html">Quick start Guide</a> or in the <a href="https://developer.dji.com/onboard-sdk/documentation/introduction/homepage.html">DJI documentation</a>.</p>
<p>You can then launch program in <code>bin</code> directory with </p><div class="fragment"><div class="line">sudo ./matrice210 1</div></div><!-- fragment --><p>If the program is launched with <code>sudo ./matrice210 0</code>, the console interface is not displayed.</p>
<h2>Result</h2>
<p>The following interface is shown in the program console when console is enabled.</p>
<div class="image">
<img src="Linux/img/Matrice210Pi.png" alt="Console output"/>
</div>
<p>Due to the watchdog, if the program is launched after the Android Application on the mobile device, data may be received before full program initialization.</p>
<div class="image">
<img src="Linux/img/Matrice210Pi_Watchdog.png" alt="Console output"/>
</div>
<p>If console is disabled, <code>Available commands</code> are not displayed.</p>
<h2>Linux service</h2>
<p>The <a href="Linux/runMatrice210.sh">runMatrice210.sh</a> script can be automatically launched from a service on Pi start-up if the <a href="Linux/matrice210.service">matrice210.service</a> is added in <code>/etc/systemd/system</code>. Linux service can then be <a href="Linux/stopMatrice210.sh">stopped</a> and <a href="Linux/startMatrice210.sh">restarted</a> with dedicated script files</p>
<h2>Log</h2>
<p>The <a href="Linux/runMatrice210.sh">runMatrice210.sh</a> saves console output in <code>build/bin/log/</code> directory. Logs are formatting as follow : <code>log[index]-[yyyy][mm][dd]-[hh][mm][ss].log</code>. GMT Date/Time is used, <code>index</code> is incremented to have numbered log and last log starts with _ char.</p>
<p>The current log file can be read in real time with command <code>tail -f _*.log</code>.</p>
<h2>Usage</h2>
<p>For full compatibility, use this code with the <a href="https://github.com/jonathanmichel/Matrice210Android">Matrice210AndroidApp</a> on an Android device connected to aircraft remote controller and the <a href="https://github.com/jonathanmichel/Matrice210Stm32">Matrice210Stm32</a> code running on a <a href="https://www.st.com/en/evaluation-tools/32f429idiscovery.html">STM32F429IDISCOVERY board</a>.</p>
<h2>Authors</h2>
<ul>
<li><b>Jonathan Michel</b> - <em>Initial work</em> - <a href="https://github.com/jonathanmichel">jonathanmichel</a> </li>
</ul>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
